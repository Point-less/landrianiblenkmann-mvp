{% extends "base.html" %}
{% load workflow_extras %}
{% block title %}Provider Intentions | {{ block.super }}{% endblock %}
{% block content %}
<div class="page-header">
    <h2>Provider Intentions</h2>
    {% if page_new_url %}
        <a class="btn" href="{{ page_new_url }}?next={{ current_url|urlencode }}">New</a>
    {% endif %}
</div>
<div class="card">
    <table>
        <tr><th>Property</th><th>Status</th><th>Transitions</th><th class="actions-column">Actions</th></tr>
        {% for intention in provider_intentions %}
            <tr>
                <td>
                    <div class="table-title">{{ intention.property }}</div>
                    <div class="table-subtext">Owner: {{ intention.owner }}</div>
                </td>
                <td>
                    <span class="pill">{{ intention.get_state_display }}</span>
                    <div class="table-subtext">Agent: {{ intention.agent }}</div>
                </td>
                <td class="latest-activity">
                    {% url 'transition-history' 'intentions' 'saleproviderintention' intention.id as history_url %}
                    {% include "workflow/partials/latest_transition.html" with transitions=intention.state_transitions.all history_url=history_url next_url=current_url %}
                </td>
                <td class="actions-column">
                    {% if intention|can_transition:'deliver_valuation' %}
                        <a class="icon-button" data-icon="ðŸ“ˆ" href="{% url 'provider-deliver-valuation' intention.id %}?next={{ current_url|urlencode }}" title="Deliver valuation">
                            <span class="sr-only">Deliver valuation</span>
                        </a>
                    {% endif %}
                    {% if intention.is_promotable %}
                        <a class="icon-button" data-icon="ðŸš€" href="{% url 'provider-promote' intention.id %}?next={{ current_url|urlencode }}" title="Promote">
                            <span class="sr-only">Promote</span>
                        </a>
                    {% endif %}
                    {% if intention|can_transition:'withdraw' %}
                        <a class="icon-button" data-icon="âœ–" data-variant="danger" href="{% url 'provider-withdraw' intention.id %}?next={{ current_url|urlencode }}" title="Withdraw intention">
                            <span class="sr-only">Withdraw intention</span>
                        </a>
                    {% endif %}
                </td>
            </tr>
        {% empty %}
            <tr><td colspan="4">No provider intentions.</td></tr>
        {% endfor %}
    </table>
</div>
{% endblock %}
