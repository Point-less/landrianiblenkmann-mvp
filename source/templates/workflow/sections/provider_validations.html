{% extends "base.html" %}
{% load workflow_extras %}
{% block title %}Documental Validations | {{ block.super }}{% endblock %}
{% block content %}
<div class="page-header">
    <h2>Documental Validations</h2>
</div>
    <div class="card">
    <table>
        <tr><th>Property</th><th>Summary</th><th>Status</th><th>Transitions</th><th class="actions-column">Actions</th></tr>
        {% for validation in provider_validations %}
            <tr>
                <td>
                    <div class="table-title">{{ validation.opportunity.source_intention.property }}</div>
                    <div class="table-subtext">Owner: {{ validation.opportunity.source_intention.owner }}</div>
                </td>
                <td>
                    {% with summary=validation.document_status_summary %}
                        <div class="table-subtext">
                            {{ summary.accepted }}/{{ summary.required_total }} accepted ·
                            {{ summary.pending }} pending ·
                            {{ summary.rejected }} rejected ·
                            {{ summary.missing }} missing
                        </div>
                        {% if summary.additional %}
                            <div class="table-subtext">Additional docs: {{ summary.additional }}</div>
                        {% endif %}
                    {% endwith %}
                </td>
                <td>
                    <span class="pill">{{ validation.get_state_display }}</span>
                </td>
                <td class="latest-activity">
                    {% url 'transition-history' 'opportunities' 'validation' validation.id as history_url %}
                    {% include "workflow/partials/latest_transition.html" with transitions=validation.state_transitions.all history_url=history_url next_url=current_url %}
                </td>
                <td class="actions-column">
                    {% include "workflow/partials/provider_validation_actions.html" with validation=validation current_url=current_url %}
                </td>
            </tr>
        {% empty %}
            <tr><td colspan="6">No validations yet.</td></tr>
        {% endfor %}
    </table>
</div>
{% endblock %}
