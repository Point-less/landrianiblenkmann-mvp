{% extends "users/auth_base.html" %}

{% block title %}Login | Marketview{% endblock %}

{% block body %}
<div class="auth-shell">
    <section class="brand-panel">
        <img src="https://static.tokkobroker.com/tfw_images/6354_Landriani%20Blenkmann/Logo_Web_1100x160_3.png" alt="Landriani Blenkmann">
        <div>
            <h1>Marketview Access</h1>
            <p>Secure workspace for managing intentions, opportunities, and deal flow. Use your password or request a one-time magic link.</p>
        </div>
        <p class="brand-footnote">Secured by django-sesame Â· Tokens expire after 5 minutes.</p>
    </section>
    <section class="auth-form">
        <div class="messages {% if messages %}has-messages{% endif %}" aria-live="polite">
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                {% endfor %}
            {% endif %}
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="password">Password</button>
            <button class="tab" data-tab="passwordless">Passwordless</button>
        </div>

        <div class="tab-panels">
            <div id="password-tab" class="tab-content active">
                <form method="post">
                    {% csrf_token %}
                    {% if form.non_field_errors %}
                        <div class="alert alert-error">{{ form.non_field_errors }}</div>
                    {% endif %}
                    <div class="form-group">
                        <label for="{{ form.username.id_for_label }}">Username</label>
                        {{ form.username }}
                        {% if form.username.errors %}<ul class="field-errors">{% for error in form.username.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                    </div>
                    <div class="form-group">
                        <label for="{{ form.password.id_for_label }}">Password</label>
                        {{ form.password }}
                        {% if form.password.errors %}<ul class="field-errors">{% for error in form.password.errors %}<li>{{ error }}</li>{% endfor %}</ul>{% endif %}
                    </div>
                    <button type="submit" class="btn">Sign In</button>
                </form>
            </div>

            <div id="passwordless-tab" class="tab-content">
                <div class="info-box">
                    <p><strong>Passwordless Login</strong></p>
                    <p>Enter your email to receive a secure link. Each link works once and expires in five minutes.</p>
                </div>
                <form method="post" action="{% url 'request-magic-link' %}">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="id_email">Email address</label>
                        <input type="email" name="email" id="id_email" required placeholder="you@example.com">
                    </div>
                    <button type="submit" class="btn">Send Magic Link</button>
                </form>
                <p class="help-text">In development, the link is printed to the console.</p>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    const tabs = document.querySelectorAll('.tab');
    const contents = document.querySelectorAll('.tab-content');

    tabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const target = tab.dataset.tab;
            tabs.forEach(t => t.classList.toggle('active', t === tab));
            contents.forEach(content => content.classList.toggle('active', content.id === `${target}-tab`));
        });
    });
</script>
{% endblock %}
