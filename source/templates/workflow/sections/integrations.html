{% extends "base.html" %}
{% block title %}Integrations | {{ block.super }}{% endblock %}
{% block content %}
<section>
    <h2>Tokkobroker</h2>
    <div class="card">
        {% url 'workflow-dashboard-section' 'integrations' as integrations_dashboard_url %}
        <div style="display:flex; gap:1rem; flex-wrap:wrap;">
            <form method="post" action="{% url 'integration-tokko-sync-now' %}">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ integrations_dashboard_url }}">
                <button type="submit">Sync immediately</button>
            </form>
            <form method="post" action="{% url 'integration-tokko-sync-enqueue' %}">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ integrations_dashboard_url }}">
                <button type="submit">Enqueue background sync</button>
            </form>
            <form method="post" action="{% url 'integration-tokko-clear' %}" onsubmit="return confirm('Clear all Tokkobroker properties?');">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ integrations_dashboard_url }}">
                <button type="submit" style="background:#dc2626;">Clear properties</button>
            </form>
        </div>
        <h4>Recent Imports</h4>
        <table>
            <tr><th>Tokko ID</th><th>Ref</th><th>Address</th><th>Imported</th></tr>
            {% for property in tokko_properties %}
                <tr>
                    <td>{{ property.tokko_id }}</td>
                    <td>{{ property.ref_code }}</td>
                    <td>{{ property.address }}</td>
                    <td>{{ property.created_at|date:"Y-m-d H:i" }}</td>
                </tr>
            {% empty %}
                <tr><td colspan="4">No Tokkobroker data yet.</td></tr>
            {% endfor %}
        </table>
    </div>
</section>
{% endblock %}
