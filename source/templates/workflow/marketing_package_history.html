{% extends "base.html" %}
{% load workflow_extras %}
{% block title %}Marketing Packages History | {{ block.super }}{% endblock %}
{% block content %}
<div class="page-header">
    <h2>Marketing Packages for {{ opportunity.source_intention.property }}</h2>
    <div class="table-subtext">Owner: {{ opportunity.source_intention.owner }}</div>
    <div class="table-subtext">Opportunity state: {{ opportunity.get_state_display }}</div>
</div>

{% for package, revisions in package_revision_rows %}
<div class="card">
    <div class="card-header">
        <div>
            <div class="table-title">{{ package.headline|default:"Unnamed package" }}</div>
            <div class="table-subtext">Current state: {{ package.get_state_display }}{% if package.price %} · {{ package.price }} {{ package.currency }}{% endif %}</div>
        </div>
        <div class="actions">
            <a class="icon-button" data-icon="✏" href="{% url 'marketing-package-edit' package.id %}?next={{ current_url|urlencode }}" title="Edit package">
                <span class="sr-only">Edit marketing package</span>
            </a>
        </div>
    </div>
    <table>
        <tr><th>Version</th><th>State</th><th>Headline</th><th>Price</th><th>Updated</th></tr>
        {% for rev in revisions %}
            <tr>
                <td>#{{ rev.version }}</td>
                <td>{{ rev.get_state_display|default:rev.state }}</td>
                <td>{{ rev.headline|default:"—" }}</td>
                <td>
                    {% if rev.price %}{{ rev.price }} {{ rev.currency }}{% else %}—{% endif %}
                </td>
                <td>{{ rev.updated_at|date:"Y-m-d H:i" }}</td>
            </tr>
        {% empty %}
            <tr><td colspan="5">No revisions yet.</td></tr>
        {% endfor %}
    </table>
</div>
{% empty %}
<div class="card"><p>No marketing packages for this opportunity.</p></div>
{% endfor %}

<div class="actions" style="margin-top:1rem;">
    <a class="button" href="{% url 'workflow-dashboard-section' section='provider-opportunities' %}">Back to opportunities</a>
</div>
{% endblock %}
