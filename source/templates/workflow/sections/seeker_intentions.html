{% extends "base.html" %}
{% load workflow_extras %}
{% block title %}Seeker Intentions | {{ block.super }}{% endblock %}
{% block content %}
<div class="page-header">
    <h2>Seeker Intentions</h2>
    {% if page_new_url %}
        <a class="btn" href="{{ page_new_url }}?next={{ current_url|urlencode }}">New</a>
    {% endif %}
</div>
<div class="card">
    <table>
        <tr><th>Contact</th><th>Status</th><th>Transitions</th><th class="actions-column">Actions</th></tr>
        {% for intention in seeker_intentions %}
            <tr>
                <td>
                    <div class="table-title">{{ intention.contact }}</div>
                    <div class="table-subtext">Agent: {{ intention.agent }}</div>
                </td>
                <td>
                    <span class="pill">{{ intention.get_state_display }}</span>
                    <div class="table-subtext">
                        {% if intention.budget_min or intention.budget_max %}
                            Budget: {{ intention.budget_min|default:"?" }} - {{ intention.budget_max|default:"?" }} {{ intention.currency|default:"" }}
                        {% else %}
                            No budget defined
                        {% endif %}
                    </div>
                </td>
                <td class="latest-activity">
                    <div class="transition-text">
                        {% with latest=intention.state_transitions.all|first %}
                            {% if latest %}
                                <span>{{ latest.from_state|default:'â€”' }} â†’ {{ latest.to_state }}</span>
                                <small class="muted">{{ latest.occurred_at|date:"m/d H:i" }}</small>
                            {% else %}
                                <span>No transitions yet.</span>
                            {% endif %}
                        {% endwith %}
                    </div>
                    <a class="history-link" href="{% url 'transition-history' 'intentions' 'saleseekerintention' intention.id %}?next={{ current_url|urlencode }}" title="View history">â†º</a>
                </td>
                <td class="actions-column">
                    {% if intention|can_transition:'activate_search' %}
                        <a class="icon-button" data-icon="â–¶" href="{% url 'seeker-activate' intention.id %}?next={{ current_url|urlencode }}" title="Activate search">
                            <span class="sr-only">Activate search</span>
                        </a>
                    {% endif %}
                    {% if intention|can_transition:'sign_mandate' %}
                        <a class="icon-button" data-icon="ðŸ“œ" href="{% url 'seeker-mandate' intention.id %}?next={{ current_url|urlencode }}" title="Sign mandate">
                            <span class="sr-only">Sign mandate</span>
                        </a>
                    {% endif %}
                    {% if intention.can_create_opportunity %}
                        <a class="icon-button" data-icon="âž•" href="{% url 'seeker-create-opportunity' intention.id %}?next={{ current_url|urlencode }}" title="Create opportunity">
                            <span class="sr-only">Create seeker opportunity</span>
                        </a>
                    {% endif %}
                    {% if intention|can_transition:'abandon' %}
                        <a class="icon-button" data-icon="âœ–" data-variant="danger" href="{% url 'seeker-abandon' intention.id %}?next={{ current_url|urlencode }}" title="Abandon intention">
                            <span class="sr-only">Abandon seeker intention</span>
                        </a>
                    {% endif %}
                </td>
            </tr>
        {% empty %}
            <tr><td colspan="4">No seeker intentions.</td></tr>
        {% endfor %}
    </table>
</div>
{% endblock %}
